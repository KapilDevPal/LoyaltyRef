<div class="card">
  <h2>Referrals</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Referral Code</th>
        <th>Clicked At</th>
        <th>User Agent</th>
        <th>IP Address</th>
        <th>Signed Up At</th>
        <th>Referee</th>
      </tr>
    </thead>
    <tbody>
      <% @referrals.each do |referral| %>
        <tr>
          <td><code><%= referral.referral_code %></code></td>
          <td><%= referral.clicked_at.strftime("%b %d, %Y %H:%M") %></td>
          <td><%= truncate(referral.user_agent, length: 50) %></td>
          <td><%= referral.ip_address %></td>
          <td>
            <% if referral.signed_up_at %>
              <%= referral.signed_up_at.strftime("%b %d, %Y %H:%M") %>
            <% else %>
              <span class="text-muted">Not signed up</span>
            <% end %>
          </td>
          <td>
            <% if referral.referee %>
              <%= referral.referee.email rescue referral.referee.id %>
            <% else %>
              <span class="text-muted">-</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= loyalty_paginate @referrals %>
</div> 